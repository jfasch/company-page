\subsection{Functions}

% --------------------------------------------------------------------
\begin{frame}
  \frametitle{Functions}

  \textbf{Function (subroutine, procedure): why?}

  \begin{itemize}
  \item Externalizing code $\to$ multiple use
  \item Program structure
  \item Readability
  \item $\to$ Key to modularization
  \end{itemize}

  \textbf{How?}

  \begin{itemize}
  \item No difference between \textit{function} and \textit{procedure}
  \item Function call can be used as value (is an expression)
  \item \textit{Except} return type is \texttt{void}
  \end{itemize}
  
\end{frame}

% --------------------------------------------------------------------
\begin{frame}[fragile]

  \begin{block}{}
\begin{verbatim}
#include <stdio.h>

int power(int base, int n)
{
    int p = 1;
    while (n--)
        p *= base;
    return p;
}

void main(void)
{
    int i;
    for (i = 0; i < 10; ++i)
        printf("2^%d = %d\n", i, power(2, i));
}
\end{verbatim}
  \end{block}

\end{frame}

% --------------------------------------------------------------------
\begin{frame}[fragile]
  \frametitle{A Nonsensical Example (1)}

  \begin{block}{}
    \begin{columns}[c]
      \begin{column}{.5\textwidth}
        \begin{block}{}
\begin{verbatim}
int power(int base, int n)
\end{verbatim}
        \end{block}
      \end{column}
      \begin{column}{.4\textwidth}
        \begin{itemize}
        \item Function name
        \item Names \textit{and types} of parameters
        \item Return type
        \end{itemize}
      \end{column}
    \end{columns}
  \end{block}

  \begin{itemize}
  \item Parameters are \textit{local} to function
  \item Parameter names only relevant inside function
  \item No conflicts with the outer world
  \item $\to$ caller may use name \texttt{base} and \texttt{i}
  \end{itemize}

\end{frame}

% --------------------------------------------------------------------
\begin{frame}[fragile]
  \frametitle{A Nonsensical Example (2)}

  \begin{block}{}
    \begin{columns}[c]
      \begin{column}{.5\textwidth}
        \begin{block}{}
\begin{verbatim}
int p = 1;
\end{verbatim}
        \end{block}
      \end{column}
      \begin{column}{.4\textwidth}
        Local variable
      \end{column}
    \end{columns}
  \end{block}

  \begin{block}{}
    \begin{columns}[c]
      \begin{column}{.5\textwidth}
        \begin{block}{}
\begin{verbatim}
while (n--)
\end{verbatim}
        \end{block}
      \end{column}
      \begin{column}{.4\textwidth}
        \texttt{n--} ... \textit{Post increment}: expression's value
        is \texttt{n}'s value \textit{before} increment
      \end{column}
    \end{columns}
  \end{block}

  \begin{block}{}
    \begin{columns}[c]
      \begin{column}{.5\textwidth}
        \begin{block}{}
\begin{verbatim}
p *= base;
\end{verbatim}
        \end{block}
      \end{column}
      \begin{column}{.4\textwidth}
        Shorthand for \texttt{p = p * base;}
      \end{column}
    \end{columns}
  \end{block}

  \begin{block}{}
    \begin{columns}[c]
      \begin{column}{.5\textwidth}
        \begin{block}{}
\begin{verbatim}
return p;
\end{verbatim}
        \end{block}
      \end{column}
      \begin{column}{.4\textwidth}
        \textit{Value} of the function as seen by the caller
      \end{column}
    \end{columns}
  \end{block}

\end{frame}

% --------------------------------------------------------------------
\begin{frame}
  \frametitle{Definition vs. Declaration (1)}

  To generate a function call, the compiler wants to know its
  \textit{prototype} $\to$ error checks

  \begin{itemize}
  \item Number of parameters
  \item Types of parameters
  \item Return type
  \end{itemize}

  Historical baggage: implicit function declarations $\to$ best
  avoided using function declarations

  \begin{itemize}
  \item \texttt{-Wimplicit}: warning issued when function called
    without declaration
  \item \texttt{-Werror}: treat warnings as errors $\to$ hygiene
  \end{itemize}

\end{frame}

% --------------------------------------------------------------------
\begin{frame}[fragile]
  \frametitle{Definition vs. Declaration (2)}

  \textbf{Declaration:} declares prototype without giving a definition

  \begin{block}{}
    \begin{columns}[c]
      \begin{column}{.5\textwidth}
        \begin{block}{}
\begin{verbatim}
int power(int base, int n);
\end{verbatim}
        \end{block}
      \end{column}
      \begin{column}{.4\textwidth}
        ``I promise that the function will have this prototype, please
        check''
      \end{column}
    \end{columns}
  \end{block}

  \begin{itemize}
  \item Definition can be given later
  \item ... in the same file, after the call
  \item ... in a different file ($\to$ later)
  \end{itemize}

\end{frame}

% --------------------------------------------------------------------
\begin{frame}[fragile]
  \frametitle{\textit{By Value} / \textit{By Reference}}

  \textbf{Parameters are only passed by value}

  \begin{itemize}
  \item Function receives a \textit{local copy} of the caller's value
  \item Modifications not visible to the caller
  \item Pass by reference $\implies$ pointers (later)
  \end{itemize}

  \begin{block}{}
    \begin{columns}[c]
      \begin{column}{.5\textwidth}
        \begin{block}{}
\begin{verbatim}
int power(int base, int n)
{
    while (n--) ...
}
\end{verbatim}
        \end{block}
      \end{column}
      \begin{column}{.4\textwidth}
        Caller does not see modifications to \texttt{n}
      \end{column}
    \end{columns}
  \end{block}
  
\end{frame}
